% Competitive Programming Library Generator - Main Template
% Engine: XeLaTeX (supports .otf fonts)
% Layout: 3-column landscape A4 with narrow margins

\documentclass[landscape,a4paper,10pt]{article}

% ===== PACKAGES =====
\usepackage[top=0.5cm, left=0.5cm, right=0.5cm, bottom=1.5cm, footskip=0.75cm]{geometry}  % Space for footer
\usepackage{multicol}                 % 3-column layout
\usepackage{fontspec}                 % Font support for XeLaTeX
\usepackage{minted}                   % Syntax highlighting
\usepackage{xcolor}                   % Colors
\usepackage{titlesec}                 % Section styling
\usepackage{tocloft}                  % TOC styling
\usepackage{hyperref}                 % Hyperlinks in TOC
\usepackage{amsmath,amssymb}         % Math support
\usepackage{needspace}                % For keeping blocks together
\usepackage{tikz}                     % For drawing dashed lines

% ===== FONT CONFIGURATION =====
% Try to load custom fonts, with robust fallbacks

% Text Font: Try custom fonts, fallback to TeX Gyre Pagella
\IfFileExists{./fonts/text-font/TeX_Gyre_Pagella-Regular.ttf}{
    \setmainfont{TeX Gyre Pagella}[
        Extension = .ttf,
        Path = ./fonts/text-font/,
        UprightFont = *-Regular,
        BoldFont = *-Bold,
        ItalicFont = *-Italic,
        BoldItalicFont = *-BoldItalic
    ]
}{
    % Fallback to system TeX Gyre Pagella
    \setmainfont{TeX Gyre Pagella}
}

% Code Font: Try custom fonts, fallback to system monospace
\IfFileExists{./fonts/code-font/JetBrains_Mono-Regular.ttf}{
    \setmonofont{JetBrains Mono}[
        Extension = .ttf,
        Path = ./fonts/code-font/,
        UprightFont = *-Regular,
        BoldFont = *-Bold,
        ItalicFont = *-Italic
    ]
}{
    % Fallback: Try DejaVu Sans Mono (common in Linux), then Liberation Mono
    \IfFontExistsTF{DejaVu Sans Mono}{
        \setmonofont{DejaVu Sans Mono}[Scale=0.9]
    }{
        \IfFontExistsTF{Liberation Mono}{
            \setmonofont{Liberation Mono}[Scale=0.9]
        }{
            % Last resort: use default monospace
            \setmonofont{Courier New}[Scale=0.9]
        }
    }
}

% Equation Font: Always use TeX Gyre Pagella Math (standard and reliable)
\usepackage{unicode-math}
\IfFileExists{./fonts/equation-font/texgyrepagella-math.otf}{
    \setmathfont{TeX Gyre Pagella Math}[
        Path = ./fonts/equation-font/
    ]
}{
    % Fallback to system TeX Gyre Pagella Math (standard in texlive)
    \setmathfont{TeX Gyre Pagella Math}
}

% Sans-serif font for headers
\setsansfont{TeX Gyre Heros}

% ===== COLOR SCHEME =====
\definecolor{sectioncolor}{RGB}{30,60,140}   % Royal Blue
\definecolor{codecolor}{RGB}{245,245,245}    % Light gray background for code

% ===== SECTION STYLING =====
% Section: Bold, colored, sans-serif
\titleformat{\section}
    {\Large\bfseries\sffamily\color{sectioncolor}}
    {}
    {0em}
    {}
    [\titlerule]

% Subsection: Bold, colored, sans-serif, smaller
\titleformat{\subsection}
    {\large\bfseries\sffamily\color{sectioncolor}}
    {}
    {0em}
    {}

% Subsubsection: Bold, colored, sans-serif, even smaller
\titleformat{\subsubsection}
    {\normalsize\bfseries\sffamily\color{sectioncolor}}
    {}
    {0em}
    {}

% Paragraph: For deeper nesting
\titleformat{\paragraph}
    {\normalsize\bfseries\sffamily\color{sectioncolor}}
    {}
    {0em}
    {}

% Reduce spacing around sections
\titlespacing{\section}{0pt}{8pt}{4pt}
\titlespacing{\subsection}{0pt}{6pt}{3pt}
\titlespacing{\subsubsection}{0pt}{4pt}{2pt}
\titlespacing{\paragraph}{0pt}{3pt}{2pt}

% ===== MINTED CONFIGURATION =====
\setminted{
    breaklines=true,
    breakanywhere=true,
    fontsize=\footnotesize,
    linenos=false,
    frame=none,
    xleftmargin=0pt,
    xrightmargin=0pt,
    style=friendly,
    tabsize=2,
    autogobble=true
}

% Make minted respect column width in multicol
\AtBeginEnvironment{minted}{%
    \par\nopagebreak
    \setlength{\LineWidth}{\linewidth}%
}
\AtEndEnvironment{minted}{\par}

% ===== TOC STYLING =====
% Compact 3-column TOC
\setlength{\columnsep}{1cm}
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}
\setlength{\cftbeforesecskip}{3pt}

% Style the "Contents" title to match section headers
\renewcommand{\contentsname}{\Large\bfseries\sffamily\color{sectioncolor}Contents}

% ===== HYPERLINK CONFIGURATION =====
\hypersetup{
    colorlinks=true,
    linkcolor=sectioncolor,
    urlcolor=sectioncolor,
    pdftitle={Competitive Programming Library},
    pdfauthor={Team Notebook}
}

% ===== DOCUMENT SETTINGS =====
\setlength{\parindent}{0pt}          % No paragraph indentation
\setlength{\parskip}{3pt}            % Small spacing between paragraphs

% Custom footer with team name and page number
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}  % Clear all headers and footers
\renewcommand{\headrulewidth}{0pt}  % Remove header line
\renewcommand{\footrulewidth}{0.4pt}  % Add footer line (separator)
\fancyfoot[C]{\small\sffamily\teamname\ -- Page \thepage}  % Center footer

% For first page (cover) - no footer
\fancypagestyle{plain}{
    \fancyhf{}
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0pt}
}

% ===== DOCUMENT BEGIN =====
\begin{document}

% Include team information (generated by generator)
\input{templates/team_info.tex}

% ===== COVER PAGE =====
\thispagestyle{plain}  % No footer on cover page
\begin{center}

\vspace*{2cm}

% Contest Title
{\Huge\bfseries\sffamily\color{sectioncolor} \contesttitle}

\vspace{1.5cm}

% Team Name
{\LARGE\bfseries\sffamily Team: \teamname}

\vspace{1cm}

% Team Members
{\large\sffamily
\textbf{Team Members:}\\[0.5cm]
\begin{tabular}{l}
\teammembers
\end{tabular}
}

\vspace{2cm}

{\large\sffamily Generated: \today}

\end{center}

\newpage

% Reset page numbering to start from 1 after cover page
\setcounter{page}{1}

% ===== TABLE OF CONTENTS AND MAIN CONTENT =====
% TOC and main content in the same flow (3 columns)
% Use multicols* to fill columns sequentially (no balancing on last page)
\begin{multicols*}{3}

\tableofcontents
\thispagestyle{fancy}  % Restore footer after TOC

\vspace{0.5cm}

% Include auto-generated content
\input{templates/content.tex}

\end{multicols*}

\end{document}
